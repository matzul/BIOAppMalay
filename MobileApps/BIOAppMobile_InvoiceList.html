<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BIOApp Mobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="img/logo.png" />
    <link href="css/loading.css" rel="stylesheet" type="text/css">
    <link href="css/calendar.css" type="text/css" rel="stylesheet" />

    <link href="googleapis/css/fonts.css" rel="stylesheet">
    <!--<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->

    <link rel="stylesheet" href="normalize/normalize.css">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">-->
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" />-->
    <!-- Font Awesome -->
    <link rel="stylesheet" href="ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" />
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css" />-->
    <!-- Ionicons -->
    <link rel="stylesheet" href="ajax/libs/ionicons/2.0.1/css/ionicons.min.css" />
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/4.5.6/css/ionicons.min.css" />-->
    <!-- DataTables -->
    <link rel="stylesheet" href="datatables/css/dataTables.bootstrap.css">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.19/css/dataTables.bootstrap.min.css">-->
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css" />
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.10/css/AdminLTE.min.css" />-->

    <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css" />
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.4.10/css/skins/_all-skins.min.css" />-->
    <!--[if lt IE 9]>
      <script src="html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script language="JavaScript" src="js/calendar.js" type="text/javascript"></script>
    <script language="JavaScript" src="js/calendar-en.js" type="text/javascript"></script>
    <script language="JavaScript" src="js/calendar-setup.js" type="text/javascript"></script>

    <style>
        body {
            padding: 0px;
            padding-bottom: 50px;
        }

        .mobile-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            will-change: transform;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            display: flex;
            height: 50px;
            box-shadow: 0 -2px 5px -2px #333;
            background-color: #fff;
        }

        .mobile-bottom-nav__item {
            flex-grow: 1;
            text-align: center;
            font-size: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .mobile-bottom-nav__item--active {
            color: red;
        }

        .mobile-bottom-nav__item-content {
            display: flex;
            flex-direction: column;
        }

        /* link */
        .content-wrapper {
            background-color: inherit;
        }

        .box-header > .box-tools {
            top: 10px;
        }

        .pagination {
            float: right !important;
            margin: inherit;
        }

        a {
            text-decoration: none;
            color: #003399;
        }

            a:hover {
                color: #0033cc;
                text-decoration: underline;
            }

            a:active {
                color: #0066FF;
            }

        #wrap {
            position: relative;
            background-image: url(images/wrap.gif);
            background-color: #fff;
        }

        /* clearer */

        /* clearfix */
        .clearfix:after {
            content: ".";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        .clearfix {
            display: inline-table;
            min-height: 1%;
        }
        /* Hides from IE-mac \*/
        * html .clearfix {
            height: 1%;
        }

        .clearfix {
            display: block;
        }
        /* End hide from IE-mac */

        .product_price {
            margin: 0px;
            padding: 5px 10px;
            background-color: #FFF;
            text-align: left;
            binvoice: 2px dashed #E0E0E0
        }
    </style>

    <script>
        window.console = window.console || function (t) { };
    </script>
    <script>
        if (document.location.search.match(/type=embed/gi)) {
            window.parent.postMessage("resize", "*");
        }
    </script>
    <style>
        .breadcrumb {
            margin-bottom: 10px;
        }

        ul.breadcrumb {
            padding: 10px 16px;
            list-style: none;
            background-color: #eee;
        }

            ul.breadcrumb li {
                display: inline;
                font-size: 18px;
            }

                ul.breadcrumb li + li:before {
                    padding: 8px;
                    color: black;
                    content: "/\00a0";
                }

                ul.breadcrumb li a {
                    color: #0275d8;
                    text-decoration: none;
                }

                    ul.breadcrumb li a:hover {
                        color: #01447e;
                        text-decoration: underline;
                    }
    </style>
</head>
<body translate="no">

    <!-- Modal -->
    <div class="modal fade" id="myDIV" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-body">
                    <div class="center-block"><img class="center-block" src="img/loader.gif" width="32" height="32" alt="" /></div>
                    <p class="text-center"> Loading...</p>
                </div>

            </div>
        </div>
    </div>
    <!--END Modal -->

    <div class="wrapper">
        <!-- Content Header (Page header) -->
        <div class="row col-lg-offset-2 col-md-offset-1 col-sm-offset-1 col-lg-8 col-md-10 col-sm-10">
            <section class="content-header">
                <h1>
                    INVOIS HASIL
                    <small>BIOApp Mobile</small>
                </h1>
            </section>

            <!-- Main content -->
            <section class="content" style="align-self: center;">
                <ol class="breadcrumb" style="align-self: auto;">
                    <li class="breadcrumb-item active"><i class="fa fa-list"></i> Senarai <span id="comp" name="comp"></span></li>
                </ol>
                <div class="menu-info">
                    <select id="searchtype" name="searchtype" class="col-lg-6 col-md-6 col-sm-6 col-xs-6 bg-gray" style="margin-bottom:5px;height:28px;">
                        <option value="INVOICENO" selected>No. Invois</option>
                        <option value="BPID">No. Pelanggan</option>
                        <option value="BPDESC">Nama Pelanggan</option>
                    </select>
                    <input type="text" id="searchitem" name="searchitem" class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-bottom:5px;height:28px;" placeholder="Carian..." />
                    <select id="invoicecat" name="invoicecat" class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-bottom:5px;height:28px;">
                        <option value="" selected>-Pilih Kategori-</option>
                        <option value="SALES_INVOICE">INVOIS JUALAN</option>
                        <option value="RECEIPT_VOUCHER">VOUCHER TERIMAAN</option>
                        <option value="JOURNAL_VOUCHER">VOUCHER PERLARASAN</option>
                    </select>
                    <select id="invoicetype" name="invoicetype" class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-bottom:5px;height:28px;">
                        <option value="" selected>-Pilih Jenis-</option>
                        <option value="NOT_APPLICABLE">TIDAK BERKENAAN</option>
                        <option value="FINANCIAL_ACQUISITION">PEROLEHAN KEWANGAN</option>
                        <option value="BANK_DEPOSIT">DEPOSIT BANK</option>
                        <option value="CASH_WITHDRAWAL">PENGELUARAN TUNAI</option>
                        <option value="OTHER_INCOME">PEROLEHAN LAIN-LAIN</option>
                    </select>
                    <input type="text" id="datefrom" name="datefrom" class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-bottom:5px;" placeholder="Tarikh Daripada..." readonly="readonly" />
                    <script type="text/javascript">
                        Calendar.setup({
                            inputField: "datefrom",     	// id of the input field
                            ifFormat: "%d-%m-%Y",   	// format of the input field
                            button: "datefrom", // trigger for the calendar (image ID)
                            align: "B1",
                            singleClick: true
                        });
                    </script>
                    <input type="text" id="dateto" name="dateto" class="col-lg-6 col-md-6 col-sm-6 col-xs-6" style="margin-bottom:5px;" placeholder="Tarikh Kepada..." readonly="readonly" />
                    <script type="text/javascript">
                        Calendar.setup({
                            inputField: "dateto",     	// id of the input field
                            ifFormat: "%d-%m-%Y",   	// format of the input field
                            button: "dateto", // trigger for the calendar (image ID)
                            align: "B1",
                            singleClick: true
                        });
                    </script>
                    <a href="#" onclick="searchinvoice();" class="btn btn-default btn-flat" style="margin-bottom:5px;">Carian</a>
                    <a href="#" onclick="resetsearch();" class="btn btn-default btn-flat" style="margin-bottom:5px;">Reset</a>
                </div>
                <div class="box">
                    <div class="box-header">
                        <button type="button" class="btn btn-sm" onclick="addnewinvoice();">Daftar Invois</button>
                        <div class="box-tools">
                            <ul class="pagination pagination-sm pull-right">
                                <li id="previouslist"><a href="#">&laquo; Previous</a></li>
                                <li id="nextlist"><a href="#">Next &raquo;</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body no-padding">

                        <table id="invoicelist" class="table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th style="display:none;">Comp</th>
                                    <th style="display:none;">InvoiceNo</th>
                                    <th>No. Invois</th>
                                    <th>Tarikh</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>

                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </section>
            <!-- /.content -->

        </div>
    </div>
    <nav class="mobile-bottom-nav">
        <div id="list" class="mobile-bottom-nav__item">
            <div class="mobile-bottom-nav__item-content mobile-bottom-nav__item--active">
                <i class="material-icons">menu</i>
                Senarai
            </div>
        </div>
        <div id="invoice" class="mobile-bottom-nav__item">
            <div class="mobile-bottom-nav__item-content">
                <i class="material-icons">local_atm</i>
                Invois
            </div>
        </div>
        <div id="report" class="mobile-bottom-nav__item">
            <div class="mobile-bottom-nav__item-content">
                <i class="material-icons">receipt</i>
                Laporan
            </div>
        </div>
    </nav>

    <!-- JQuery -->
    <script src="https://adminlte.io/themes/AdminLTE/bower_components/jquery/dist/jquery.min.js"></script>
    <!--<script src="dist/js/jquery.min.js"></script>-->
    <!-- Bootstrap 3.3.6 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!--<script src="bootstrap/js/bootstrap.min.js"></script>-->
    <!-- AdminLTE App -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/admin-lte/2.3.11/js/app.min.js"></script>
    <!--<script src="dist/js/app.min.js"></script>-->
    <!-- DataTables -->
    <script src="https://adminlte.io/themes/AdminLTE/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <!--<script src="datatables/js/jquery.dataTables.js"></script>-->

    <script src="https://adminlte.io/themes/AdminLTE/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <!--<script src="datatables/js/bootstrap.dataTables.js"></script>-->

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/JQuery.WebService.Call.Helper.js" type="text/javascript"></script>

    <script id="rendered-js">
        var navItems = document.querySelectorAll(".mobile-bottom-nav__item");
        navItems.forEach(function (e, i) {
            e.addEventListener("click", function (e) {
                navItems.forEach(function (e2, i2) {
                    e2.classList.remove("mobile-bottom-nav__item--active");
                });
                this.classList.add("mobile-bottom-nav__item--active");
                if (this.id == "list") {
                    window.location.href = "BIOAppMobile_InvoiceList.html?userid=" + userid;
                }
                else if (this.id == "invoice") {
                    window.location.href = "BIOAppMobile_InvoicePage.html?userid=" + userid;
                }
                else if (this.id == "report") {
                    window.location.href = "BIOAppMobile_InvoiceList.html?userid=" + userid;
                }
            });
        });

        function getParameterByName(name) {
            name = name.replace(/[[]/, "\[").replace(/[]]/, "\]");
            var regex = new RegExp("[\?&]" + name + "=([^&#]*)"), results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

    </script>
    <script>
        var userid;
        var comp;

        var oTable;

        var today = new Date();
        var selyear = today.getFullYear();
        var selmonth = today.getMonth() + 1;
        if (selmonth < 10) {
            selmonth = '0' + selmonth;
        }
        var selday = '01';

        //On document ready
        $(document).ready(function () {

            $('#myDIV').modal({ backdrop: "static" });

            userid = getParameterByName('userid');

            var parameters_getMobile_UserProfile = ["userid", userid];
            PageMethod("getMobile_UserProfile", parameters_getMobile_UserProfile, succeededAjaxFn_getMobile_UserProfile, failedAjaxFn_getMobile_UserProfile, false);

            oTable = $('#invoicelist').DataTable({
                'paging': true,
                'pageLength': 5,
                'lengthChange': false,
                'searching': false,
                'invoiceing': true,
                'info': false,
                'autoWidth': true,
                "dom": "lfrti",
                "columnDefs": [
                    {
                        "targets": [1],
                        "visible": false,
                        "searchable": false
                    },
                    {
                        "targets": [2],
                        "visible": false
                    }
                ]
            });

            if (comp && comp.length) {

                $("#datefrom").val(selday + '-' + selmonth + '-' + selyear);

                var parameters_getMobile_InvoiceList = ["comp", comp, "searchtype", $("#searchtype").val(), "searchitem", $("#searchitem").val(), "datefrom", $("#datefrom").val(), "dateto", $("#dateto").val(), "invoicecat", $("#invoicecat").val(), "invoicetype", $("#invoicetype").val()];
                PageMethod("getMobile_InvoiceList", parameters_getMobile_InvoiceList, succeededAjaxFn_getMobile_InvoiceList, failedAjaxFn_getMobile_InvoiceList, false);

                $('#previouslist').on('click', function () {
                    oTable.page('previous').draw('page');
                });

                $('#nextlist').on('click', function () {
                    oTable.page('next').draw('page');
                });

                $('#invoicelist tbody').on('click', 'tr', function () {
                    var data = oTable.row(this).data();
                    //alert('You clicked on ' + data[1] + ':' + data[2]);
                    openinvoice(data[2]);
                });

            }

            $('#myDIV').modal('hide');
        })

        succeededAjaxFn_getMobile_UserProfile = function (data, textStatus, jqXHR) {
            console.log("succeededAjaxFn_getMobile_UserProfile: " + textStatus);

            result_getMobile_UserProfile = JSON.parse(data.d);

            comp = result_getMobile_UserProfile.GetSetcomp;
            $('#comp').text('[ ' + comp + ']');
        }

        //notification for failed ajax transaction
        failedAjaxFn_getMobile_UserProfile = function (jqXHR, textStatus, errorThrown) {
            console.log("failedAjaxFn_getMobile_UserProfile: " + textStatus);
            //$('#myDIV').modal('hide');
        }

        succeededAjaxFn_getMobile_InvoiceList = function (data, textStatus, jqXHR) {
            console.log("succeededAjaxFn_getMobile_InvoiceList: " + textStatus);
            //oTable.dataTable().fnClearTable();
            oTable.clear().draw();

            result_getMobile_InvoiceList = JSON.parse(data.d);
            $.each(result_getMobile_InvoiceList, function (i, result) {

                oTable.row.add([
                    i + 1,
                    result.GetSetcomp,
                    result.GetSetinvoiceno,
                    result.GetSetinvoiceno + '<br/>' + result.GetSetbpdesc + '<br/>' + result.GetSetbpid,
                    result.GetSetinvoicedate + '<br/>' + result.GetSetbpaddress,
                    (result.GetSetstatus == 'NEW' ?
                        '<span class="label label-primary">' + result.GetSetstatus + '</span>' :
                        result.GetSetstatus == 'INPROGRESS' ?
                            '<span class="label label-warning">' + result.GetSetstatus + '</span>' :
                            result.GetSetstatus == 'CONFIRMED' ?
                                '<span class="label label-success">' + result.GetSetstatus + '</span>' : '<span class="label label-danger">' + result.GetSetstatus + '</span>')
                ]).draw(false);
            });
        }

        //notification for failed ajax transaction
        failedAjaxFn_getMobile_InvoiceList = function (jqXHR, textStatus, errorThrown) {
            console.log("failedAjaxFn_getMobile_InvoiceList: " + textStatus);
            //$('#myDIV').modal('hide');
        }

        function searchinvoice() {
            $('#myDIV').modal({ backdrop: "static" });

            if (comp && comp.length) {

                var parameters_getMobile_InvoiceList = ["comp", comp, "searchtype", $("#searchtype").val(), "searchitem", $("#searchitem").val(), "datefrom", $("#datefrom").val(), "dateto", $("#dateto").val(), "invoicecat", $("#invoicecat").val(), "invoicetype", $("#invoicetype").val()];
                PageMethod("getMobile_InvoiceList", parameters_getMobile_InvoiceList, succeededAjaxFn_getMobile_InvoiceList, failedAjaxFn_getMobile_InvoiceList, false);

                $('#previouslist').on('click', function () {
                    oTable.page('previous').draw('page');
                });

                $('#nextlist').on('click', function () {
                    oTable.page('next').draw('page');
                });

                $('#invoicelist tbody').on('click', 'tr', function () {
                    var data = oTable.row(this).data();
                    //alert('You clicked on ' + data[1] + ':' + data[2]);
                    openinvoice(data[2]);
                });

            }

            $('#myDIV').modal('hide');
        }

        function resetsearch() {
            $('#myDIV').modal({ backdrop: "static" });

            $("#searchitem").val("");
            $("#datefrom").val("");
            $("#dateto").val("");

            if (comp && comp.length) {

                var parameters_getMobile_InvoiceList = ["comp", comp, "searchtype", $("#searchtype").val(), "searchitem", $("#searchitem").val(), "datefrom", $("#datefrom").val(), "dateto", $("#dateto").val(), "invoicecat", $("#invoicecat").val(), "invoicetype", $("#invoicetype").val()];
                PageMethod("getMobile_InvoiceList", parameters_getMobile_InvoiceList, succeededAjaxFn_getMobile_InvoiceList, failedAjaxFn_getMobile_InvoiceList, false);

                $('#previouslist').on('click', function () {
                    oTable.page('previous').draw('page');
                });

                $('#nextlist').on('click', function () {
                    oTable.page('next').draw('page');
                });

                $('#invoicelist tbody').on('click', 'tr', function () {
                    var data = oTable.row(this).data();
                    //alert('You clicked on ' + data[1] + ':' + data[2]);
                    openinvoice(data[2]);
                });

            }

            $('#myDIV').modal('hide');
        }

        function addnewinvoice() {
            if (userid && userid.length) {
                if (comp && comp.length) {
                    window.location.href = "BIOAppMobile_InvoicePage.html?userid=" + userid + "&comp=" + comp + "&invoiceno=";
                }
            }
        }

        function openinvoice(invoiceno) {
            if (userid && userid.length) {
                if (comp && comp.length) {
                    if (invoiceno && invoiceno.length) {
                        window.location.href = "BIOAppMobile_InvoicePage.html?userid=" + userid + "&comp=" + comp + "&invoiceno=" + invoiceno;
                    }
                }
            }
        }

    </script>
</body>
</html>
